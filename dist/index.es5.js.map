{"version":3,"file":"index.es5.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["export const isZh = () => {\n  return /zh/i.test(navigator.language)\n}\n\nexport const isimToken = () => {\n  const imToken = (window as any).imToken\n  return imToken && imToken.version\n}\n\nexport const isUnSupportScheme = () => {\n  const ua = navigator.userAgent\n  const isWechat = /micromessenger\\/([\\d.]+)/i.test(ua)\n  const isQQ = /qq\\/([\\d.]+)/i.test(ua)\n  return isWechat || isQQ\n}\n\nexport const isAndroid = () => {\n  const ua = navigator.userAgent\n  return /android/i.test(ua)\n}\n\nexport const isChrome = () => {\n  const ua = navigator.userAgent\n  return /chrome\\/[\\d.]+ Mobile Safari\\/[\\d.]+/i.test(ua)\n}\n\nexport const isiOS = () => {\n  const ua = navigator.userAgent\n  return /iphone|ipad|ipod/i.test(ua)\n}\n\nexport const isiPhoneX = () => {\n  return /iphone/gi.test(navigator.userAgent) && screen.height >= 812\n}\n\nexport const openByLocation = (url: string) => {\n  location.href = url\n}\n\nexport const openByIframe = (url: string) => {\n  const ifr = document.createElement('iframe')\n  ifr.src = url\n  ifr.style.display = 'none'\n  document.body.appendChild(ifr)\n}\n\nexport const openByTagA = (url: string) => {\n  const tagA = document.createElement('a')\n  tagA.setAttribute('href', url)\n  tagA.style.display = 'none'\n  document.body.appendChild(tagA)\n  tagA.click()\n}\n","import { isimToken, isZh, isUnSupportScheme, isAndroid, openByIframe, openByLocation, isiOS, isChrome, openByTagA, isiPhoneX } from './utils'\n\ninterface Props {\n  schemeUrl?: string\n  fallbackUrl?: string\n  buttonStyle?: any\n  buttonText?: string\n  timeout?: number\n}\n\nconst buttonStyle = {\n  position: 'fixed',\n  zIndex: 9999,\n  bottom: '25px',\n  left: '50%',\n  transform: 'translateX(-50%)',\n  background: '#0890BE',\n  boxShadow: '0px 6px 8px rgba(22, 21, 60, 0.2)',\n  borderRadius: '50px',\n  padding: '14px 28px',\n  fontSize: '15px',\n  color: '#fff',\n  borderStyle: 'none',\n  outline: 'none',\n  fontFamily: 'sans-serif',\n}\n\nconst getDefaultProps = () => {\n  return {\n    schemeUrl: 'imtokenv2://navigate/DappView',\n    fallbackUrl: 'https://token.im/download',\n    buttonStyle: isiPhoneX() ? { ...buttonStyle, bottom: '59px' } : buttonStyle,\n    buttonText: isZh ? '打开 imToken' : 'Open in imToken',\n    timeout: 2000,\n  }\n}\n\nexport default class OpenApp {\n  props: any\n  tip: any\n  timer: any\n\n  constructor(props: Props = {}) {\n    const defaultProps = getDefaultProps()\n    this.props = { ...defaultProps, ...props }\n    this.render()\n  }\n\n  render() {\n    if (isimToken()) {\n      return\n    }\n\n    if (isAndroid() || isiOS()) {\n      this.renderButton()\n      this.renderTip()\n    }\n  }\n\n  renderButton() {\n    const { buttonStyle, buttonText } = this.props\n    const button = document.createElement('button')\n    // apply btn text\n    button.innerHTML = buttonText\n    // apply style\n    Object.keys(buttonStyle).forEach(attr => {\n      button.style[attr as any] = buttonStyle[attr]\n    })\n    // append to body\n    const body = document.getElementsByTagName('body')[0]\n    body.appendChild(button)\n    // add click event\n    button.addEventListener('click', this.open)\n  }\n\n  renderTip() {\n    this.tip = document.createElement('div')\n    const step1Text = isZh ? '1. 点击更多' : '1. Click More'\n    const step2Text = isZh ? '2. 请选择「在浏览器中打开」' : '2. Choose “Open in Browser”'\n    const styleContainner = `\n      position: fixed;\n      z-index: 10000;\n      top: 0;\n      right: 0;\n      left: 0;\n      bottom: 0;\n      background-color: rgba(35, 33, 71, 0.8);\n    `\n    const styleArrow = `\n      position: absolute;\n      top: -16px;\n      right: 6px;\n    `\n    const styleMore = `\n      position: absolute;\n      top: 70px;\n      right: 130px;\n      text-align: center;\n    `\n\n    const styleText = `\n      font-size: 17px;\n      line-height: 17px;\n      text-align: center;\n      color: #fff;\n      margin-top: 16px;\n    `\n\n    const styleArrowOpen = `\n      position: absolute;\n      top: 94px;\n      right: 194px;\n    `\n\n    const styleOpen = `\n      position: absolute;\n      top: 195px;\n      right: 60px;\n      text-align: center;\n    `\n\n    this.tip.innerHTML = `\n      <div style=\"${styleContainner}\">\n        <img style=\"${styleArrow}\" src=\"https://cdn.whale.token.im/open-app/oa-arrow-click.svg\" alt=\"arrow\" />\n        <div style=\"${styleMore}\">\n          <img src=\"https://cdn.whale.token.im/open-app/oa-more.svg\" alt=\"more\" />\n          <div style=\"${styleText}\">${step1Text}</div>\n        </div>\n        <img style=\"${styleArrowOpen}\" src=\"https://cdn.whale.token.im/open-app/oa-arrow-open.svg\" alt=\"arrow\" />\n        <div style=\"${styleOpen}\">\n          <img src=\"https://cdn.whale.token.im/open-app/oa-browser.svg\" alt=\"arrow\" />\n          <div style=\"${styleText}\">${step2Text}</div>\n        </div>\n      </div>\n    `\n    // hide\n    this.tip.style.display = 'none'\n    // append to body\n    const body = document.getElementsByTagName('body')[0]\n    body.appendChild(this.tip)\n    // add click event\n    this.tip.addEventListener('click', this.hideTip)\n  }\n\n  showTip = () => {\n    this.tip.style.display = 'block'\n  }\n\n  hideTip = () => {\n    this.tip.style.display = 'none'\n  }\n\n  open = () => {\n    // imToken\n    if (isimToken()) {\n      return\n    }\n\n    // show tip\n    if (isUnSupportScheme()) {\n      this.showTip()\n      return\n    }\n\n    // try to open app\n    const { schemeUrl } = this.props\n    const url = `${schemeUrl}?url=${location.href}`\n    if (isAndroid()) {\n      if (isChrome()) {\n        openByTagA(url)\n      } else {\n        openByIframe(url)\n      }\n    } else {\n      openByLocation(url)\n    }\n    this._checkOpen()\n  }\n\n  fallback = () => {\n    const { fallbackUrl } = this.props\n    location.href = `${fallbackUrl}?from=open-app`\n  }\n\n  _checkOpen = () => {\n    let haveChange = false\n    let property = 'hidden'\n    let eventName = 'visibilitychange'\n\n    // Opera 12.10 and Firefox 18 and later support\n    if (typeof document.hidden !== 'undefined') {\n      property = 'hidden'\n      eventName = 'visibilitychange'\n    } else if (typeof (document as any).msHidden !== 'undefined') {\n      property = 'msHidden'\n      eventName = 'msvisibilitychange'\n    } else if (typeof (document as any).webkitHidden !== 'undefined') {\n      property = 'webkitHidden'\n      eventName = 'webkitvisibilitychange'\n    }\n\n    const pageChange = (e: any) => {\n      haveChange = true\n      if ((document as any)[property] || e.hidden || document.visibilityState === 'hidden') {\n        // success\n      } else {\n        this.fallback()\n      }\n      removeEvents()\n    }\n\n    const removeEvents = () => {\n      document.removeEventListener(eventName, pageChange)\n      document.removeEventListener('baiduboxappvisibilitychange', pageChange)\n    }\n\n    const addEvents = () => {\n      document.addEventListener(eventName, pageChange, false)\n      document.addEventListener('baiduboxappvisibilitychange', pageChange, false)\n    }\n\n    addEvents()\n\n    clearTimeout(this.timer)\n    this.timer = setTimeout(() => {\n      if (haveChange) {\n        return\n      }\n\n      removeEvents()\n\n      this.fallback()\n      haveChange = true\n    }, this.props.timeout)\n  }\n}\n"],"names":[],"mappings":"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"}