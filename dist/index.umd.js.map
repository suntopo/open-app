{"version":3,"file":"index.umd.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["export const isZh = () => {\n  return /zh/i.test(navigator.language)\n}\n\nexport const isimToken = () => {\n  return typeof (window as any).imToken !== 'undefined'\n}\n\nexport const isUnSupportScheme = () => {\n  const ua = navigator.userAgent\n  const isWechat = /micromessenger\\/([\\d.]+)/i.test(ua)\n  return isWechat\n}\n\nexport const isAndroid = () => {\n  const ua = navigator.userAgent\n  return /android/i.test(ua)\n}\n\nexport const isiOS = () => {\n  const ua = navigator.userAgent\n  return /iphone|ipad|ipod/i.test(ua)\n}\n\nexport const openByLocation = (url: string) => {\n  location.href = url\n}\n\nexport const openByIframe = (url: string) => {\n  const ifr = document.createElement('iframe')\n  ifr.src = url\n  ifr.style.display = 'none'\n  document.body.appendChild(ifr)\n}\n","import { isimToken, isZh, isUnSupportScheme, isAndroid, openByIframe, openByLocation, isiOS } from './utils'\n\ninterface Props {\n  schemeUrl?: string\n  fallbackUrl?: string\n  buttonStyle?: any\n  buttonText?: string\n  timeout?: number\n}\n\nconst buttonStyle = {\n  position: 'fixed',\n  zIndex: 999,\n  bottom: '80px',\n  left: '50%',\n  transform: 'translateX(-50%)',\n  background: '#0890BE',\n  boxShadow: '0px 6px 8px rgba(22, 21, 60, 0.2)',\n  borderRadius: '50px',\n  padding: '14px 28px',\n  fontSize: '15px',\n  color: '#fff',\n  borderStyle: 'none',\n}\n\nconst getDefaultProps = () => {\n  return {\n    schemeUrl: 'imtokenv2://navigate/DappView',\n    fallbackUrl: 'https://token.im/download',\n    buttonStyle: buttonStyle,\n    buttonText: isZh ? '打开 imToken' : 'Open imToken',\n    timeout: 2000,\n  }\n}\n\nexport default class OpenApp {\n  props: any\n  tip: any\n  timer: any\n\n  constructor(props: Props = {}) {\n    const defaultProps = getDefaultProps()\n    this.props = { ...defaultProps, ...props }\n    this.render()\n  }\n\n  render() {\n    if (isimToken()) {\n      return\n    }\n\n    if (isAndroid() || isiOS()) {\n      this.renderButton()\n      this.renderTip()\n    }\n  }\n\n  renderButton() {\n    const { buttonStyle, buttonText } = this.props\n    const button = document.createElement('button')\n    // apply btn text\n    button.innerHTML = buttonText\n    // apply style\n    Object.keys(buttonStyle).forEach(attr => {\n      button.style[attr as any] = buttonStyle[attr]\n    })\n    // append to body\n    const body = document.getElementsByTagName('body')[0]\n    body.appendChild(button)\n    // add click event\n    button.addEventListener('click', this.open)\n  }\n\n  renderTip() {\n    this.tip = document.createElement('div')\n    const step1Text = isZh ? '点击更多' : '1. Click More'\n    const step2Text = isZh ? '选择在浏览器中打开' : '2. Choose “Open in Browser”'\n    const styleContainner = `\n      position: fixed;\n      top: 0;\n      right: 0;\n      left: 0;\n      bottom: 0;\n      background-color: rgba(35, 33, 71, 0.8);\n    `\n    const styleArrow = `\n      position: absolute;\n      top: -16px;\n      right: 6px;\n    `\n    const styleMore = `\n      position: absolute;\n      top: 70px;\n      right: 130px;\n      text-align: center;\n    `\n\n    const styleText = `\n      font-size: 17px;\n      line-height: 17px;\n      text-align: center;\n      color: #fff;\n      margin-top: 16px;\n    `\n\n    const styleArrowOpen = `\n      position: absolute;\n      top: 94px;\n      right: 194px;\n    `\n\n    const styleOpen = `\n      position: absolute;\n      top: 195px;\n      right: 60px;\n      text-align: center;\n    `\n\n    this.tip.innerHTML = `\n      <div style=\"${styleContainner}\">\n        <img style=\"${styleArrow}\" src=\"https://cdn.whale.token.im/open-app/oa-arrow-click.svg\" alt=\"arrow\" />\n        <div style=\"${styleMore}\">\n          <img src=\"https://cdn.whale.token.im/open-app/oa-more.svg\" alt=\"more\" />\n          <div style=\"${styleText}\">${step1Text}</div>\n        </div>\n        <img style=\"${styleArrowOpen}\" src=\"https://cdn.whale.token.im/open-app/oa-arrow-open.svg\" alt=\"arrow\" />\n        <div style=\"${styleOpen}\">\n          <img src=\"https://cdn.whale.token.im/open-app/oa-browser.svg\" alt=\"arrow\" />\n          <div style=\"${styleText}\">${step2Text}</div>\n        </div>\n      </div>\n    `\n    // hide\n    this.tip.style.display = 'none'\n    // append to body\n    const body = document.getElementsByTagName('body')[0]\n    body.appendChild(this.tip)\n    // add click event\n    this.tip.addEventListener('click', this.hideTip)\n  }\n\n  showTip = () => {\n    this.tip.style.display = 'block'\n  }\n\n  hideTip = () => {\n    this.tip.style.display = 'none'\n  }\n\n  open = () => {\n    // imToken\n    if (isimToken()) {\n      return\n    }\n\n    // show tip\n    if (isUnSupportScheme()) {\n      this.showTip()\n      return\n    }\n\n    // try to open app\n    const { schemeUrl } = this.props\n    const url = `${schemeUrl}?url=${location.href}`\n    if (isAndroid()) {\n      openByIframe(url)\n    } else {\n      openByLocation(url)\n    }\n    this._checkOpen()\n  }\n\n  fallback = () => {\n    const { fallbackUrl } = this.props\n    location.href = `${fallbackUrl}?from=open-app`\n  }\n\n  _checkOpen = () => {\n    let haveChange = false\n    let property = 'hidden'\n    let eventName = 'visibilitychange'\n\n     // Opera 12.10 and Firefox 18 and later support\n    if (typeof document.hidden !== 'undefined') {\n      property = 'hidden'\n      eventName = 'visibilitychange'\n    } else if (typeof (document as any).msHidden !== 'undefined') {\n      property = 'msHidden'\n      eventName = 'msvisibilitychange'\n    } else if (typeof (document as any).webkitHidden !== 'undefined') {\n      property = 'webkitHidden'\n      eventName = 'webkitvisibilitychange'\n    }\n\n    const pageChange = (e: any) => {\n      haveChange = true\n      if ((document as any)[property] || e.hidden || document.visibilityState === 'hidden') {\n        // success\n      } else {\n        this.fallback()\n      }\n      removeEvents()\n    }\n\n    const removeEvents = () => {\n      document.removeEventListener(eventName, pageChange)\n      document.removeEventListener('baiduboxappvisibilitychange', pageChange)\n    }\n\n    const addEvents = () => {\n      document.addEventListener(eventName, pageChange, false)\n      document.addEventListener('baiduboxappvisibilitychange', pageChange, false)\n    }\n\n    addEvents()\n\n    clearTimeout(this.timer)\n    this.timer = setTimeout(() => {\n      if (haveChange) {\n        return\n      }\n\n      removeEvents()\n\n      this.fallback()\n      haveChange = true\n    }, this.props.timeout)\n  }\n}\n"],"names":[],"mappings":"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"}